<!DOCTYPE html>
<html lang="ch">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" type="text/css" href="./common.css">
  <title>video demo</title>
</head>

<body>
  <h1 id="title">交互式视频平台demo</h1>
  <div class="video-wrapper">
    <video src="./video/takePhoto/head.mp4" poster="" controls id="video" autoplay="autoplay" preload="auto"></video>
    <div class="select-wrapper">
      <ul>
        <li>
          <div class="text">片头</div>
          <img src="./images/position.png" data-src="./video/takePhoto/head.mp4" class="icon" />
        </li>
      </ul>
    </div>
    <div class="option-wrapper">
      <div class="question">你要学习哪种构图方式呢？</div>
      <ul class="clearfix">
        <li>A.井字法构图</li>
        <li>B.对角线构图</li>
        <li>C.三角形构图</li>
        <li>D.对称式构图</li>
      </ul>
    </div>
  </div>
</body>
<script>
  (function () {
    var oVideo, oVideoWrapper, oSelectBtn, oText;
    var scale = 0.8;
    var flag = true;

    var initialize = function () {
      oVideo = document.getElementById('video');
      oVideoWrapper = document.getElementsByClassName('video-wrapper')[0];
      oSelectWrapper = document.getElementsByClassName('select-wrapper')[0];
      aSelectIcon = oSelectWrapper.getElementsByTagName('li');
      oOption = oVideoWrapper.getElementsByClassName('option-wrapper')[0];
      aOption = oOption.getElementsByTagName('li');

      oVideoWrapper.onmouseover = function () {
        oSelectWrapper.style.visibility = 'visible';
      };

      oVideoWrapper.onmouseout = function () {
        oSelectWrapper.style.visibility = 'hidden';
      };

      refreshSelect();
      caluSelectPosition();
      oVideo.addEventListener('ended', choice);
    };
    // -------------------------------------------------------------------------------------

    function refreshSelect() {
      for (let i = 0; i < aSelectIcon.length; i++) {
        let oText = aSelectIcon[i].getElementsByClassName('text')[0];
        aSelectIcon[i].onmouseover = function () {
          oText.style.display = 'block'
        };
        aSelectIcon[i].onmouseout = function () {
          oText.style.display = 'none';
        };
        aSelectIcon[i].onclick = function () {
          for (let j = 0; j < aSelectIcon.length; j++) {
            let oImg = aSelectIcon[j].getElementsByTagName('img')[0];
            oImg.src = "./images/tick.png";
          }
          let oImg = aSelectIcon[i].getElementsByTagName('img')[0];
          oImg.src = "./images/position.png";
          oVideo.src = oImg.getAttribute('data-src');
        }
      }
    }
    // -------------------------------------------------------------------------------------
    // 设置select按钮的居中位置
    function caluSelectPosition() {
      var videoWidth = oVideo.clientWidth;
      var width = (videoWidth - oSelectWrapper.clientWidth) / 2;
      oSelectWrapper.style.left = `${width}px`;
    };
    // -------------------------------------------------------------------------------------

    var choice = function () {
      oVideo = document.getElementById('video');
      if (oVideo.src.split('/').pop() == 'head.mp4') {
        oOption.style.display = 'block';
        oSelectWrapper.style.display = 'none';
        oVideo.controls = false;

        for (let i = 0; i < aOption.length; i++) {
          aOption[i].onclick = function () {
            oVideo.src = `./video/takePhoto/${i + 1}.mp4`;
            oOption.style.display = 'none';
            oSelectWrapper.style.display = 'block';
            let oUl = oSelectWrapper.getElementsByTagName('ul')[0];
            let oImg = aSelectIcon[0].getElementsByTagName('img')[0];
            if (flag) {
              flag = false;
            } else {
              let aLi = oUl.getElementsByTagName('li');
              oUl.removeChild(aLi[aLi.length - 1]);
            }
            oImg.src = "./images/tick.png";
            oUl.innerHTML += `<li><div class="text">${this.innerHTML}</div><img src="./images/position.png" class="icon" data-src="./video/takePhoto/${i + 1}.mp4"/>
        </li>`;
            oVideo.controls = true;
            oVideo.currentTime = 0;
            caluSelectPosition();
            refreshSelect();
          }
        }
      }
    };

    // -------------------------------------------------------------------------------------
    // 获取元素样式值
    function getStyle(obj, attr) {
      if (obj.currentStyle) {
        return obj.currentStyle[attr];
      } else {
        return getComputedStyle(obj, null)[attr];
      }
    }

    initialize();
  })();
</script>

</html>