<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>互动视频平台</title>
  <link rel="stylesheet" href="https://neveragain.allstatics.com/2019/assets/style/bootstrap-wondershare.min.css">
  <style>
    .banner {
      background: url(images/bg.jpg) center bottom no-repeat;
      background-size: 100% 100%;
      height: 32rem;
    }

    .active {
      color: rgb(67, 172, 203)
    }

    .videType li:hover {
      cursor: pointer;
    }

    .videoList .col-3:hover {
      cursor: pointer;
    }

    .tab-active {
      background: rgb(67, 172, 203);
      color: #ffffff;
    }
  </style>
</head>

<body>
  <header id="header">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-7 font-weight-bolder">互动视频平台</div>
        <div class="col-5 text-right">
          <a href="index.html" target="_block" class="btn border-0 tab-active">首页</a>
          <a href="#" target="_block" class="btn border-0" id="updata">创作中心</a>
          <a href="userInfor.html" target="_block" class="btn border-0 d-none" id="usericon">你好，油菜花</a>
          <a href="#" target="_block" class="btn border-0 d-none" id="logout">退出</a>
          <a href="#" target="_block" class="btn border-0" data-toggle="modal" data-target="#modal-popup"
            id="logicon">登录</a>
        </div>
      </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="modal-popup" role="dialog">
      <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content p-3">
          <div class="modal-header pt-0" style="border: 0;">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <ul class="nav d-flex justify-content-center" id="myTab" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#login" role="tab"
                  aria-controls="login" aria-selected="true">登录</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#signup" role="tab" aria-controls="signup"
                  aria-selected="false">注册</a>
              </li>
            </ul>
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active " id="login" role="tabpanel" aria-labelledby="login-tab">
                <div class="form-group mt-3">
                  <input type="email" class="form-control" id="logEmail" placeholder="邮箱地址">
                  <input type="password" class="form-control mt-3" id="logPassword" placeholder="密码">
                  <div class="row my-3">
                    <div class="col-6 d-flex align-items-center pr-0">
                      <input type="checkbox" class="mr-2" id="ifRemember" style="width: 20px;height: 20px;"><label
                        class="text-gray-8 m-0">记住我</label>
                    </div>
                    <div class="col-6 text-right"><a href="#" class="text-action">忘记密码</a></div>
                  </div>
                </div>
                <p class="text-center text-secondary mt-3 mb-0 d-none" id="logErrorMessage"></p>
                <button type="submit" class="btn btn-action w-100 mb-3 with-box-shadow" id="logIn">登录</button>
              </div>
              <div class="tab-pane fade" id="signup" role="tabpanel" aria-labelledby="signup-tab">
                <div class="form-group mt-3">
                  <input type="text" class="form-control" id="userName" placeholder="昵称">
                  <input type="email" class="form-control mt-3" id="signEmail" placeholder="邮箱">
                  <input type="password" class="form-control my-3" id="signpassword" placeholder="密码"
                    data-toggle="tooltip" data-placement="right" title="密码应包含6-18个字符，字符仅包括数字字母，下划线和*">
                  <p class="text-center text-secondary mt-3 mb-0 d-none" id="signErrorMessage"></p>
                  <button type="submit" class="btn btn-action w-100 mb-3 with-box-shadow" id="signUp">注册</button>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <main class="wsc-main px-0 text-center" id="main">
    <div class="banner pt-5 position-relative">
      <div class="container py-5">
        <a href="#" class="position-absolute text-white font-size-lager font-size-huge"
          style="bottom: 4.125rem;left:48%;text-decoration: none;">搜 索</a>
      </div>
    </div>
    <div class="py-5">
      <div class="container py-4">
        <h2 class="text-center py-4">全部课程</h2>
        <ul class="list-inline d-flex justify-content-around font-size-extra videType">
          <li class="list-unstyled list-inline-item active">全部</li>
          <li class="list-unstyled list-inline-item">大学</li>
          <li class="list-unstyled list-inline-item">高中</li>
          <li class="list-unstyled list-inline-item">初中</li>
          <li class="list-unstyled list-inline-item">小学</li>
          <li class="list-unstyled list-inline-item">幼教</li>
          <li class="list-unstyled list-inline-item">科普生活</li>
        </ul>
        <div class="py-3">
          <div class="row videoList">
            <div class="col-3 with-hand">
              <video src="D:\greenDownload\wamp64\www\demo\upload\5b02ac134b42852dca97aeb316abbab6.mp4"
                class="w-100"></video>
              <p class="py-3">三角形构图法则</p>
            </div>
            <div class="col-3">
              <video src="D:\greenDownload\wamp64\www\demo\upload\5b02ac134b42852dca97aeb316abbab6.mp4"
                class="w-100"></video>
              <p class="py-3">三角形构图法则</p>
            </div>
            <div class="col-3">
              <video src="D:\greenDownload\wamp64\www\demo\upload\5b02ac134b42852dca97aeb316abbab6.mp4"
                class="w-100"></video>
              <p class="py-3">三角形构图法则</p>
            </div>
            <div class="col-3">
              <video src="D:\greenDownload\wamp64\www\demo\upload\5b02ac134b42852dca97aeb316abbab6.mp4"
                class="w-100"></video>
              <p class="py-3">三角形构图法则</p>
            </div>
            <div class="col-3">
              <video src="D:\greenDownload\wamp64\www\demo\upload\5b02ac134b42852dca97aeb316abbab6.mp4"
                class="w-100"></video>
              <p class="py-3">三角形构图法则</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer class="wsc-footer2020"></footer>
  <script src="https://neveragain.allstatics.com/2019/assets/vendor/wsc-vendor.js"></script>
  <script src="https://neveragain.allstatics.com/2019/assets/script/wsc-override-ws.js"></script>
  <script src="https://neveragain.allstatics.com/2019/assets/script/wsc-common.js"></script>
  <script>$(function () { wsc.common.init() })</script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script>
    //  判断是否登陆
    $.ajax({
      url: 'php/session.php',
      type: "get",
      dataType: "json",
      success: function (data) {
        console.log(data);
        if (data.code) {
          $('#logicon').addClass('d-none')
          $('#usericon').removeClass('d-none')
          $('#logout').removeClass('d-none')
          $('#usericon').html(`你好，${data.user_name}`)
        }
      },
      error: function (error) {
        console.log(error)
      }
    })

    //  分类点击事件
    $(".videType li").click(function () {
      let _this = $(this);
      $(".videType li").removeClass('active');
      _this.addClass('active');
    })

    // 登录请求
    $('#logIn').click(function () {
      let email = $('#logEmail').val()
      let password = $('#logPassword').val()
      $('#logErrorMessage').addClass('d-none')

      if (checkEmail(email) && checkPasswrod(password)) {
        var data = {
          "user_email": email,
          "user_password": password,
          "act": 'login'
        };
        //验证
        $.ajax({
          url: 'php/login.php',
          type: "POST",
          dataType: "json",
          data: data,
          success: function (data) {
            if (data.code) {
              //  清空表单数据
              if (data.user_type == 1) {
                $('#logEmail').val('')
                $('#logPassword').val('')

                $('#modal-popup').modal('hide')
                swal("登陆成功", {
                  icon: "success",
                  buttons: false,
                  timer: 2000
                }).then((value) => {
                  //  登录成功后显示用户头像
                  $('#logicon').addClass('d-none')
                  $('#usericon').removeClass('d-none')
                  $('#logout').removeClass('d-none')
                  $('#usericon').html(`你好，${data.user_name}`)
                })
              } else {
                swal("登陆成功", {
                  icon: "success",
                  buttons: false,
                  timer: 2000
                }).then(() => {
                  window.location.href = 'admin.html'
                })
              }

            } else {
              $('#logErrorMessage').removeClass('d-none')
              $('#logErrorMessage').html(data.msg)
            }
          },
          error: function (error) {
            console.log(error)
          }
        })
      } else {
        $('#logErrorMessage').removeClass('d-none')
        $('#logErrorMessage').html(errorMessage)
      }
    })

    //  注册请求
    $('#signUp').click(function () {
      let email = $('#signEmail').val()
      let password = $('#signpassword').val()
      $("#signErrorMessage").addClass('d-none')
      if (checkEmail(email) && checkPasswrod(password)) {
        var data = {
          "user_name": $('#userName').val(),
          "user_email": email,
          "user_password": password
        }
        //验证
        $.ajax({
          url: 'php/register.php',
          type: "post",
          dataType: "JSON",
          data: data,
          success: function (data) {
            console.log(data);
            //  判断账号是否已经被注册
            if (data.code) {
              //  清空表单数据
              $('#userName').val('')
              $('#signEmail').val('')
              $('#signpassword').val('')
              $('#modal-popup').modal('hide')
              swal({
                icon: "success",
                title: "注册成功",
                text: "马上登陆"
              }).then(() => {
                //  注册成功后跳转到登录tab
                $('#modal-popup').modal('show')
                $('#modal-popup li:first-child a').tab('show')
              })
            } else {
              $('#signErrorMessage').removeClass('d-none')
              $('#signErrorMessage').html(data.msg)
            }
          },
          error: function (err) {
            window.console.log(err)
          }
        })
      } else {
        $('#signErrorMessage').removeClass('d-none')
        $('#signErrorMessage').html(errorMessage)
      }
    })

    //  校验邮箱
    function checkEmail(email) { // check if empty of email and pattern the emaill
      if (email.length === 0) {
        errorMessage = '邮箱地址不能为空'; return false
      } else {
        const pattern = /^[a-zA-Z0-9\._-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+){1,3}$/ // 匹配邮件正则
        if (!pattern.test(email)) {
          errorMessage = '邮箱地址无效'; return false
        } else {
          return true
        }
      }
    }

    //  检验密码
    function checkPasswrod(password) { // check if empty of password
      if (password.length === 0) {
        errorMessage = '密码不能尾矿库'; return false
      } else {
        if (password.length < 6 || password.length > 18) {
          errorMessage = '密码应该在6-18位之间'; return false
        } else {
          return true
        }
      }
    }

    //  登出请求
    $('#logout').click(function () {
      $.ajax({
        url: `php/login.php`,
        dataType: 'json',
        data: { 'act': 'logout' },
        type: 'post',
        success: function (data) {
          if (data.msg) {
            swal("成功退出", {
              icon: "success",
              buttons: false,
              timer: 2000
            }).then((value) => {
              //  退出成功后隐藏用户头像
              $('#logicon').removeClass('d-none')
              $('#usericon').addClass('d-none')
              $('#logout').addClass('d-none')
              // location.href('index.html')
            })
          }

        },
        error: function (err) {
          window.console.log(err)
        }
      })
    })

    //  跳转到创作中心
    $('#updata').click(function(){
      $.ajax({
      url: 'php/session.php',
      type: "get",
      dataType: "json",
      success: function (data) {
        if (data.code) {
          window.location.href = "videoInfo.html";
        } else {
          $('#modal-popup').modal('show');
        }
      },
      error: function (error) {
        console.log(error)
      }
    })

    })
  </script>
</body>

</html>